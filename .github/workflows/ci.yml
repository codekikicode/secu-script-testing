name: CI - Playwright Tests

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4


      - uses: actions/setup-node@v4
        with:
          node-version: 22


      - run: npm install
      - run: npx playwright install --with-deps

  # run tests
      - run: npm test

  # save HTML report
      - if: always()
        uses: actions/upload-artifact@v4
        with:
        name: playwright-report
        path: playwright-report/

  # -----------------------------------------
  # DISCORD NOTIFICATION — SUCCESS
  # -----------------------------------------
      - name: Notify Discord on success
        if: success()
        run: |
        curl -X POST -H "Content-Type: application/json" \
        -d "{\"content\": \"✅ CI Passed for $GITHUB_REPOSITORY on commit $GITHUB_SHA\"}" \
        ${{ secrets.DISCORD_WEBHOOK_URL }}:

  # -----------------------------------------
  # DISCORD NOTIFICATION — FAILURE
  # -----------------------------------------
      - name: Notify Discord on failure
        if: failure()
        run: |
      curl -X POST -H "Content-Type: application/json" \
      -d "{\"content\": \"❌ CI Failed for $GITHUB_REPOSITORY on commit $GITHUB_SHA\"}" \
      ${{ secrets.DISCORD_WEBHOOK_URL }}
